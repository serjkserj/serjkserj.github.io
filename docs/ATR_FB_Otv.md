Приведенные вами источники описывают рекомендуемый подход к работе с заданиями на отверстия в Revit с использованием плагина FutureBIM, который в первую очередь предполагает **работу в ЕДИНОМ центральном файле "Задание на отверстия"**.

Ваш предварительный сценарий, где "Для каждого файла AR свой файл SHAFT" и "Далее этот файл SHAFT добавляется в файл AR связью", **отличается от стандартной рекомендации FutureBIM**. Согласно источникам, работа с несколькими файлами "Заданий на отверстия" или обмен группами имеет существенные недостатки, такие как сложность координации, временные задержки, невозможность изменения значений в таблицах, риск потери данных из-за различных ID у одного и того же кубика в разных моделях, и постоянная потребность в участии BIM-специалистов. FutureBIM стремится к единой базе данных для совместной работы.

Тем не менее, адаптируем инструкцию под ваш случай, но с учетом важных нюансов и рекомендаций из источников:

### **Инструкция по работе с заданиями на отверстия (адаптировано для вашего проекта)**

В данном подходе предполагается, что файл MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt выступает в роли файла "Задание на отверстия" для соответствующей архитектурной модели MNVNK_ATR_PD_B12.2_K1_AR_R2022.rvt.

**Этап 1: Подготовка файла SHAFT и создание "Кубиков" (инженеры / BIM-специалист)**

1. **Создание файла задания на отверстия:  
    **
    - BIM-специалист или инженер создает новый файл Revit на основе подготовленного шаблона, называя его, например, **MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt**. Шаблон обычно чище от труб, стен, материалов для меньшего веса и быстрой работы.
    - Файл сохраняется в папку с проектом. Если это Revit Server, то сначала сохраняется локально, потом создается локальная копия, и она кладется на сервер.
2. **Подгрузка связанных моделей:  
    **
    - В файл MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt подгружаются **все необходимые связи, которые будут участвовать в формировании отверстий**. Это включает:
        - **Архитектурная модель:** MNVNK_ATR_PD_B12.2_K1_AR_R2022.rvt.
        - **Конструктивная модель:** (Например, KR, если она существует).
        - **Инженерные модели:** (Например, ВК и ОВ, или другие инженерные разделы).
    - **Важно:** Координаты и уровни в файле MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt должны соответствовать модели архитектуры.
    - Для каждой связанной модели необходимо создать свой рабочий набор и поместить связь в него. Рекомендуется наименование рабочих наборов связей по формату: \_Поле1_Связь_Поле2 (например, \_01_Связь_АР, \_02_Связь_КР, \_03_Связь_ОВ1).
3. **Настройка ролей и контроль изменений (BIM-специалист):  
    **
    - В файле MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt BIM-специалист активирует функцию **"Контроль изменений"**.
    - Все участники процесса согласования (инженеры, архитекторы, конструкторы) должны синхронизироваться в модели, чтобы их имена появились в списке ролей.
    - BIM-специалист назначает роли (например, "инженер", "архитектор", "конструктор").
    - Для каждой роли назначаются разрешения на редактирование параметров согласования, например, инженер может ставить только галочку "Согласовано ИОС", архитектор – "Согласовано АР", а конструктор – "Согласовано КР". Это предотвращает несанкционированное согласование.
    - Настройки ролей и разрешений можно экспортировать и импортировать через файл XML для удобства между проектами.
    - **Важное замечание:** "Контроль изменений" будет работать только при установленном плагине FutureBIM у всех участников и активированной галочке "Включить контроль".
4. **Создание "Кубиков" (инженеры):  
    **
    - Инженеры используют функцию **"Задание на отверстия"** во вкладке "Модель". Плагин автоматически создает "кубики" (условное представление инженерного отверстия) в местах пересечения инженерных сетей с несущими конструкциями.
    - Кубики могут быть круглыми (цилиндры) или прямоугольными (параллелепипеды).
    - При создании кубиков плагин автоматически задает их габариты кратно 5 мм, привязки к осям и высотные отметки также кратно 5 мм.
    - "Кубики" создаются только в местах пересечения с железобетонными и кладочными конструкциями, а не там, где отверстия делаются "по месту". Для этого используются фильтры по параметру типа или экземпляра конструкции ("Монолит", "Кладка", "Обстройка").
    - Плагин автоматически заполняет параметры кубиков, такие как "Номер кубика" (равный ID элемента Revit), "Тип системы" (например, ОВ1, ВК1), и "Дата изменения".
    - **Не объединяйте кубики на этом этапе!** Инженерам не рекомендуется объединять кубики при создании; это решение принимают архитекторы и конструкторы позже.
    - Инженеры должны проверить наличие пересечений коммуникаций между собой и с колоннами, балками и т.д. _до_ выдачи задания на отверстия, при необходимости изменяя трассировку.

**Этап 2: Проверка задания на отверстия (инженеры)**

1. **Выполнение проверки:**
    - Инженеры используют функцию **"Проверить задание"** для проверки корректности созданных "кубиков".
    - Функция покажет отсутствующие кубики в местах пересечений, некорректно выставленные кубики (неверный габарит, некорректный ID, некорректный тип системы), а также лишние кубики.
    - Настройки фильтров (инженерные системы, конструкции, корпуса, этажи) сохраняются из функции "Задание на отверстия".
    - Результаты проверки записываются в параметр "Статус" кубиков.
    - Отчет о проверке можно экспортировать (например, в CSV) и прикладывать к официальной переписке. Этот файл служит гарантией того, что задание выполнено и проверено.
    - **Важно:** Проверка должна быть выполнена самими инженерами _перед_ выдачей задания.

**Этап 3: Согласование "Кубиков" (инженеры, архитекторы, конструкторы)**

1. **Последовательность согласования:  
    **
    - Процесс согласования идет последовательно: **ИОС -> АР -> КР**. Общение происходит в едином файле MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt через заранее заготовленные таблицы и историю изменений.
    - **Инженеры:** Согласовывают свои "кубики" ("Согласовано ИОС" = "Да"). В таблицах они видят только те кубики, которые еще не согласованы ими.
    - **Архитекторы:** После согласования инженерами, архитекторы рассматривают кубики. В таблицах они видят кубики, где "Согласовано ИОС" = "Да", но "Согласовано АР" = "Нет".
    - **Конструкторы:** После согласования инженерами и архитекторами, конструкторы рассматривают кубики. В таблицах они видят кубики, где "Согласовано ИОС" = "Да" и "Согласовано АР" = "Да", но "Согласовано КР" = "Нет".
2. **Действия с "Кубиками":  
    **
    - **Изменение габаритов / Перемещение:** Если архитектор или конструктор изменяет габариты или перемещает кубик, плагин **автоматически сбрасывает предыдущие галочки согласования** (например, "Согласовано ИОС"). Пользователь не может контролировать этот сброс.
    - **Статусы изменений:** Специалисты могут указывать статус кубика в параметре "Статус":
        - **"Удалить":** Кубик не удаляется, но помечается для удаления инженерами.
        - **"Добавить":** Используется, если кубик добавляется в проект.
        - **"Изменить габарит":** Указывается при изменении размеров.
        - **"Переместить":** Указывается при изменении положения.
        - **"Обсудить":** Кубик не согласован, требуется дальнейшее обсуждение. В "Комментарии АР/КР/ИОС" добавляется информация.
        - **Пустое поле:** Кубик остается без изменений.
    - **Комментарии:** Используются для обмена информацией между разделами.
    - **"История изменений":** Функция позволяет увидеть полную историю изменений каждого кубика: кто, что, когда поменял (дату, время, ID, семейство, параметр, старое/новое значение, пользователя, рабочее место). Отчет можно экспортировать в CSV для анализа.
    - **"Объединить кубики":** Архитекторы и конструкторы могут объединять пересекающиеся "кубики" (или те, что находятся на расстоянии 100 мм и меньше) в одно отверстие с помощью функции "Объединить кубики". При этом также сбрасываются галочки согласования.
    #### **Альтернативный упрощенный вариант: Обновление и замена "Кубиков" (для ускоренных итераций)**

В целях ускорения рабочего процесса, особенно на ранних стадиях проектирования или при незначительных корректировках, может применяться упрощенная схема, минуя полноценное многоэтапное согласование. В этом случае ответственность за проверку и принятие изменений ложится на BIM-специалиста или архитектора, работающего в файле AR.

**Процесс обновления:**

1.  **Подготовка файла SHAFT (Инженеры):**
    *   Инженеры вносят необходимые изменения в файл `MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt`: добавляют, удаляют, перемещают или изменяют габариты "кубиков".
    *   **Важно:** Все изменения должны быть зафиксированы в параметрах кубиков (Статус, Комментарий ИОС, Дата изменения), даже если полноценное согласование не проводится. Это обеспечивает прозрачность изменений.
    *   Инженеры сохраняют и синхронизируют файл SHAFT.

2.  **Обновление связи в файле AR (BIM-специалист / Архитектор):**
    *   Пользователь открывает архитектурную модель `MNVNK_ATR_PD_B12.2_K1_AR_R2022.rvt`.
    *   Обновляет связанную модель `MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt` через менеджер связей Revit, чтобы получить последние изменения.

3.  **Анализ изменений (BIM-специалист / Архитектор):**
    *   Используя преднастроенные 3D виды в файле AR, настроенные для отображения связанных кубиков из файла SHAFT, пользователь визуально анализирует характер изменений.
    *   **Ключевая проверка:** Обращает особое внимание на наличие "кубиков" в перекрытиях. Их появление сигнализирует о коллизии, требующей немедленного уведомления инженеров. В вашем процессе отверстия в перекрытиях создаются с помощью вертикальных шахт, а не кубиков.
    *   Оценивает масштаб изменений:
        *   **Незначительные изменения** (например, небольшой сдвиг или изменение габарита одного-двух кубиков): можно отредактировать существующие кубики в файле AR вручную.
        *   **Значительные изменения** (множество новых, удаленных или сильно измененных кубиков): рекомендуется полная замена.

4.  **Замена "Кубиков" (BIM-специалист / Архитектор):**
    *   **Удаление старых кубиков:** Выделяет и удаляет все старые "кубики" (элементы категории "Обобщенная модель", созданные плагином) из предыдущей версии задания в файле AR.
    *   **Импорт новых кубиков:**
        *   Использует функцию плагина FutureBIM **"Импорт кубиков"** (или "Скопировать кубики", в зависимости от версии плагина).
        *   В настройках функции выбирает связанную модель `MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt` как источник.
        *   **Фильтрация:** Для точного импорта выбирает нужный **Рабочий набор** (например, `_03_Связь_ОВ1`) и, при необходимости, **Тип системы**. Это позволяет импортировать только актуальные кубики нужного раздела.
        *   Запускает импорт. Плагин создаст в файле AR новые экземпляры "кубиков", соответствующие текущему состоянию файла SHAFT.

5.  **Создание реальных отверстий (BIM-специалист / Архитектор):**
    *   Использует функцию плагина FutureBIM **"Соединение элементов"**.
    *   Выбирает в качестве "Режущих элементов" только что импортированные "кубики" (категория "Обобщенные модели").
    *   Выбирает в качестве "Целевых элементов" категории, в которых нужно создать отверстия (Стены, Полы, Потолки).
    *   Запускает функцию. Плагин автоматически выполнит команду "Соединить/Отменить соединение" в Revit, создавая физические проемы.

---


**Этап 4: Копирование и финализация отверстий (BIM-специалист / архитекторы / конструкторы)**

1. **Копирование согласованных кубиков:  
    **
    - После того как "кубик" согласован всеми тремя разделами ("Согласовано АР", "Согласовано КР", "Согласовано ИОС" имеют значение "Да"), он может быть скопирован в соответствующие модели (АР и КР).
    - Для этого используется функция **"Скопировать кубики"**. Архитекторы или конструкторы, работая в своих моделях (например, MNVNK_ATR_PD_B12.2_K1_AR_R2022.rvt), подгружают файл MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt как связь.
    - В функции "Скопировать кубики" рекомендуется выбирать режим "по фильтру" и фильтровать только **полностью согласованные кубики** (где "Согласовано АР", "Согласовано КР", "Согласовано ИОС" = "Да").
    - **Важно:** Плагин не будет дублировать уже скопированные "кубики" в то же самое место, даже если они были слегка изменены в файле AR/KR, если их габариты и положение не менялись.
    - Если "кубик" был скопирован вручную или изменен после копирования в модель AR/KR, то при повторной генерации он будет считаться новым элементом, и его ID изменится, а согласование сбросится. Для обновления параметров таких кубиков можно использовать функцию "Задание на отверстия. Обновить".
2. **Создание реальных отверстий:  
    **
    - После копирования "кубиков" в модели АР/КР, они пересекаются с конструкциями. Для создания физических отверстий и устранения коллизий используется стандартная функция Revit "Соединить".
    - Для автоматизации этого процесса рекомендуется использовать функцию **"Соединение элементов"** из плагина FutureBIM. Выбираются "Обобщенные модели" (кубики) и категории, с которыми их нужно соединить (стены, перекрытия, потолки, полы).
3. **Оформление чертежей:  
    **
    - Копированные "кубики" отображаются на разрезах по ГОСТу и на планах со штриховкой.
    - Для оформления чертежей можно использовать марку для "кубиков", предлагаемую FutureBIM, которая отображает информацию о типе системы, габаритах и отметке низа проема от чистого пола.
    - Функция **"Отметки проемов"** может автоматически заполнять параметры "Верх проема" и "Низ проема".
    - Параметры "Видимость вверх" и "Видимость вниз" в семействе кубика позволяют настроить отображение линии отверстия на планах, если секущий диапазон не затрагивает основной объем кубика, избегая необходимости менять секущий диапазон или фрагменты плана.
    - Параметры "Дополнительная ширина" и "Дополнительная толщина" позволяют увеличить габариты кубика для прорезания дополнительных слоев (например, утеплителя, пола, потолка).

**Ключевые отличия вашего подхода от рекомендаций FutureBIM, которые следует учитывать:**

- **Множество SHAFT-файлов:** Ваш подход "для каждого файла AR свой файл SHAFT" **противоречит основному принципу FutureBIM** – использованию единого файла "Задание на отверстия" для всех разделов. Это может привести к проблемам с координацией, уникальными ID для одного и того же отверстия, и усложнению контроля.
- **едактирование связанных моделей:** Вы указали "Далее этот файл SHAFT добавляется в файл AR связью". **Revit не позволяет изменять элементы связанной модели**. Это означает, что архитекторы и конструкторы **не смогут редактировать или согласовывать кубики, находясь в своем файле AR, где SHAFT подгружен как связь**. Для внесения изменений и проставления галочек согласования (этап 3) **им необходимо будет работать напрямую в файле MNVNK_ATR_PD_B12.2_K1_SHAFT.rvt**. Только после завершения всех согласований, финальные согласованные кубики копируются _из_ SHAFT-файла _в_ AR/KR модели (этап 4).

**Дополнительное примечание по упрощенному варианту:**
Хотя упрощенный вариант значительно ускоряет процесс, он несет риски потери истории изменений и контроля за согласованием. Рекомендуется использовать его только на ранних стадиях или для незначительных правок. По мере приближения к финальным стадиям проектирования следует переходить на полный цикл согласования (ИОС -> АР -> КР) для обеспечения максимальной точности и юридической/технической корректности документации.
